<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Same head content as before -->
</head>
<body>
    <!-- Same HTML structure as before -->

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Initialization
        const firebaseConfig = {
            apiKey: "AIzaSyCBg6RQXIiC2BKE2HjzochEeiajc7fBnZA",
            authDomain: "bookswap-bac8b.firebaseapp.com",
            projectId: "bookswap-bac8b",
            storageBucket: "bookswap-bac8b.firebasestorage.app",
            messagingSenderId: "145814837614",
            appId: "1:145814837614:web:7d52eb3c29fe659688097f",
            measurementId: "G-Q33CEMLPZ5"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const loginForm = document.getElementById('loginForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const errorMessage = document.getElementById('errorMessage');
        const createAccountBtn = document.getElementById('createAccount');

        // Login Handler
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMessage.textContent = '';
            
            try {
                const email = emailInput.value;
                const password = passwordInput.value;
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                
                // Update last login time
                await db.collection('users').doc(userCredential.user.uid).update({
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert('Successfully logged in!');
                // window.location.href = '/dashboard.html';
            } catch (error) {
                showError(error.message);
            }
        });

        // Create Account Handler
        createAccountBtn.addEventListener('click', async () => {
            try {
                const email = emailInput.value;
                const password = passwordInput.value;

                if (!email || !password) {
                    showError('Please fill in all fields');
                    return;
                }

                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Save user data to Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                    provider: 'email/password'
                });

                alert('Account created successfully!');
            } catch (error) {
                showError(error.message);
            }
        });

        // Password Reset Handler
        document.getElementById('forgotPassword').addEventListener('click', async (e) => {
            e.preventDefault();
            const email = prompt('Please enter your email address:');
            
            if (email) {
                try {
                    await auth.sendPasswordResetEmail(email);
                    alert('Password reset email sent!');
                } catch (error) {
                    showError(error.message);
                }
            }
        });

        // Error Handling
        function showError(message) {
            errorMessage.textContent = message;
            setTimeout(() => errorMessage.textContent = '', 5000);
        }

        // Auth State Listener
        auth.onAuthStateChanged(user => {
            if (user) {
                console.log('Authenticated user:', user.email);
            } else {
                console.log('No authenticated user');
            }
        });
    </script>
</body>
</html>
